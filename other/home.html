<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sinema | Home</title>
  <link rel="stylesheet" href="home.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    .suggestion-option {
      display: flex;
      align-items: center;
      padding: 5px;
    }
    .suggestion-img {
      width: 30px;
      height: 40px;
      margin-right: 10px;
      object-fit: cover;
    }
    .suggestion-text {
      flex-grow: 1;
      color: black;
    }
  </style>
</head>

<body onLoad="MM_preloadImages('../img/roll/nextscroll.png')">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <img class="logo" src="../img/LOGO.png" alt="Sinema Logo"/>
      <div class="search-bar">
        <div class="search-bar-inner">
          <svg class="search-image" viewBox="0 0 24 24" width="20" height="20">
            <path d="M15.5 14h-.79l-.28-.27C16.41 12.59 17 11.11 17 9.5 17 5.91 14.09 3 10.5 3S4 5.91 4 9.5 6.91 16 10.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10.5 14C8.01 14 6 11.99 6 9.5S8.01 5 10.5 5 15 7.01 15 9.5 12.99 14 10.5 14z"></path>
          </svg>
      
          <input
            id="search-input"
            class="search-input"
            type="text"
            placeholder="Search..."
            oninput="handleSearchInput(this.value)"
          />
      
          <svg class="search-button" viewBox="0 0 24 24" width="24" height="24">
            <path fill="white" d="M15.5 14h-.79l-.28-.27C16.41 12.59 17 11.11 17 9.5 17 5.91 14.09 3 10.5 3S4 5.91 4 9.5 6.91 16 10.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10.5 14C8.01 14 6 11.99 6 9.5S8.01 5 10.5 5 15 7.01 15 9.5 12.99 14 10.5 14z"></path>
          </svg>
        </div>
      
        <div id="suggestions-container"></div>
      </div>
      
    </header>

        <!-- Discover Section -->
        <section class="discover-screen">
          <h2>Discover</h2>
          <div class="discovery-box"></div>
        </section>
    
        <!-- Latest Movies -->
        <section class="latest-content">
          <h2>Latest Movies</h2>
          <div class="title-bar"></div>
          <div id="latest-movies-container" class="movies-container"></div>
          <!-- Movie Arrows -->
          <a href="#" id="movie-scroll-left-link" class="scroll-button">
            <svg width="40" height="40" viewBox="0 0 24 24" style="opacity:0.8;">
              <path fill="white" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
            </svg>
          </a>
    
          <a href="#" id="movie-scroll-right-link" class="scroll-button">
            <svg width="40" height="40" viewBox="0 0 24 24" style="opacity:0.8;">
              <path fill="white" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"></path>
            </svg>
          </a>
        </section>
    
        <!-- Latest TV Shows -->
        <section class="latest-content">
          <h2>Latest TV Shows</h2>
          <div class="title-bar"></div>
          <div id="latest-tv-container" class="movies-container"></div>
          <!-- TV Arrows -->
          <a href="#" id="tv-scroll-left-link" class="scroll-button">
            <svg width="40" height="40" viewBox="0 0 24 24" style="opacity:0.8;">
              <path fill="white" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
            </svg>
          </a>
    
          <a href="#" id="tv-scroll-right-link" class="scroll-button">
            <svg width="40" height="40" viewBox="0 0 24 24" style="opacity:0.8;">
              <path fill="white" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"></path>
            </svg>
          </a>
        </section>
      </div>
      
        <!-- JS Logic -->
  <script>
    const apiKey = '0e1a4d969bc043a99a76f16143ed629b';
    const baseUrl = 'https://api.themoviedb.org/3';

    function MM_swapImgRestore() {
      var i, x, a = document.MM_sr;
      for (i = 0; a && i < a.length && (x = a[i]) && x.oSrc; i++) x.src = x.oSrc;
    }

    function MM_preloadImages() {
      var d = document;
      if (d.images) {
        if (!d.MM_p) d.MM_p = new Array();
        var i, j = d.MM_p.length, a = MM_preloadImages.arguments;
        for (i = 0; i < a.length; i++)
          if (a[i].indexOf("#") != 0) {
            d.MM_p[j] = new Image;
            d.MM_p[j++].src = a[i];
          }
      }
    }

    function MM_findObj(n, d) {
      var p, i, x;
      if (!d) d = document;
      if ((p = n.indexOf("?")) > 0 && parent.frames.length) {
        d = parent.frames[n.substring(p + 1)].document;
        n = n.substring(0, p);
      }
      if (!(x = d[n]) && d.all) x = d.all[n];
      for (i = 0; !x && i < d.forms.length; i++)
        x = d.forms[i][n];
      for (i = 0; !x && d.layers && i < d.layers.length; i++)
        x = MM_findObj(n, d.layers[i].document);
      if (!x && d.getElementById) x = d.getElementById(n);
      return x;
    }

    function MM_swapImage() {
      var i, j = 0, x, a = MM_swapImage.arguments;
      document.MM_sr = new Array;
      for (i = 0; i < (a.length - 2); i += 3)
        if ((x = MM_findObj(a[i])) != null) {
          document.MM_sr[j++] = x;
          if (!x.oSrc) x.oSrc = x.src;
          x.src = a[i + 2];
        }
    }

    async function fetchSuggestions(query) {
      try {
        const response = await fetch(`${baseUrl}/search/multi?api_key=${apiKey}&query=${query}`);
        if (!response.ok) {
          throw new Error('Failed to fetch suggestions');
        }
        const data = await response.json();
        return data.results;
      } catch (error) {
        console.error('Error fetching suggestions:', error);
        return [];
      }
    }

    function handleSearchInput(value) {
      if (value.trim() === '') {
        document.getElementById('suggestions-container').innerHTML = '';
        return;
      }

      fetchSuggestions(value)
        .then(displaySuggestions)
        .catch((error) => console.error('Error fetching suggestions:', error));
    }

    function displaySuggestions(suggestions) {
      const suggestionsContainer = document.getElementById('suggestions-container');
      suggestionsContainer.innerHTML = '';

      if (suggestions.length > 0) {
        suggestions.forEach((result) => {
          const suggestionOption = document.createElement('div');
          suggestionOption.classList.add('suggestion-option');

          const img = document.createElement('img');
          img.classList.add('suggestion-img');
          img.src = result.poster_path
            ? `https://image.tmdb.org/t/p/w92${result.poster_path}`
            : 'https://png.pngtree.com/element_our/png/20181205/question-mark-vector-icon-png_256683.jpg';
          suggestionOption.appendChild(img);

          const text = document.createElement('span');
          text.classList.add('suggestion-text');
          text.textContent = result.title || result.name;
          suggestionOption.appendChild(text);

          suggestionsContainer.appendChild(suggestionOption);

          suggestionOption.addEventListener('click', function () {
            document.getElementById('search-input').value = text.textContent;
            suggestionsContainer.innerHTML = '';

            if (result.media_type === 'movie') {
              window.location.href = `movie_details.html?id=${result.id}`;
            } else if (result.media_type === 'tv') {
              window.location.href = `tv_details.html?id=${result.id}`;
            } else {
              console.error('Unknown media_type:', result.media_type);
            }
          });
        });

        suggestionsContainer.style.display = 'block';
      } else {
        suggestionsContainer.style.display = 'none';
      }
    }

    async function fetchAndDisplay(type, containerId) {
      let url = '';

      if (type === 'movie') {
        url = `${baseUrl}/${type}/popular?api_key=${apiKey}`;
      } else if (type === 'tv') {
        const unwantedGenres = '99,10763,10764,10766,10767'; // Documentary, News, Reality, Soap, Talk
        url = `${baseUrl}/trending/tv/week?api_key=${apiKey}` +
              `&sort_by=popularity.desc` +
              `&without_genres=${unwantedGenres}` +
              `&language=en-US` +
              `&vote_average.gte=7` +
              `&region=US`;
      }

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (type === 'movie') {
            displayMovies(data.results, containerId);
          } else if (type === 'tv') {
            displayTVShows(data.results, containerId); // Results already filtered
          }
        })
        .catch(error => console.error(`Error fetching latest ${type}:`, error));
    }


    function displayMovies(movies, containerId) {
      const moviesContainer = document.getElementById(containerId);
      movies.forEach(movie => {
        const movieCard = document.createElement('div');
        movieCard.classList.add('movie-card');

        const movieDetails = document.createElement('div');
        movieDetails.classList.add('movie-details');
        movieDetails.innerHTML = `
          <p>${movie.title} (${getReleaseYear(movie.release_date)})</p>
        `;
        movieCard.appendChild(movieDetails);

        const moviePoster = document.createElement('img');
        moviePoster.src = `https://image.tmdb.org/t/p/w500${movie.poster_path}`;
        moviePoster.alt = movie.title;
        movieCard.appendChild(moviePoster);

        movieCard.addEventListener('click', function () {
          window.location.href = `movie_details.html?id=${movie.id}`;
        });

        moviesContainer.appendChild(movieCard);
      });
    }

    function displayTVShows(tvShows, containerId) {
      const tvContainer = document.getElementById(containerId);
      tvShows.forEach(show => {
        const showCard = document.createElement('div');
        showCard.classList.add('movie-card');

        const showDetails = document.createElement('div');
        showDetails.classList.add('movie-details');
        showDetails.innerHTML = `
          <p>${show.name} (${getReleaseYear(show.first_air_date)})</p>
        `;
        showCard.appendChild(showDetails);

        const showPoster = document.createElement('img');
        showPoster.src = `https://image.tmdb.org/t/p/w500${show.poster_path}`;
        showPoster.alt = show.name;
        showCard.appendChild(showPoster);

        showCard.addEventListener('click', function () {
          window.location.href = `tv_details.html?id=${show.id}`;
        });

        tvContainer.appendChild(showCard);
      });
    }

    function getReleaseYear(dateString) {
      const year = new Date(dateString).getFullYear();
      return isNaN(year) ? 'N/A' : year;
    }

    async function fetchBannerImages(type) {
      try {
        const response = await fetch(`${baseUrl}/trending/${type}/day?api_key=${apiKey}`);
        const data = await response.json();
        return data.results;
      } catch (error) {
        console.error(`Error fetching ${type} banner images:`, error);
        return [];
      }
    }

    function createBanner(item) {
      const banner = document.createElement('div');
      banner.classList.add('banner');

      const image = document.createElement('img');
      image.src = `https://image.tmdb.org/t/p/original${item.backdrop_path}`;
      image.alt = item.title || item.name;
      banner.appendChild(image);

      const tooltip = document.createElement('div');
      tooltip.classList.add('banner-tooltip');
      tooltip.innerHTML = `
        <p>${item.title || item.name}</p>
        ${item.vote_average ? `<p>Rating: ${item.vote_average}/10</p>` : ''}
      `;
      banner.appendChild(tooltip);

      banner.addEventListener('mouseover', () => {
        tooltip.style.display = 'block';
      });

      banner.addEventListener('mouseleave', () => {
        tooltip.style.display = 'none';
      });

      banner.addEventListener('click', () => {
        const id = item.id;
        const mediaType = item.media_type === 'movie' ? 'movie' : 'tv';
        window.location.href = `${mediaType}_details.html?id=${id}`;
      });

      return banner;
    }

    async function populateDiscoveryBox() {
      try {
        const discoveryBox = document.querySelector('.discover-screen .discovery-box');
        discoveryBox.innerHTML = '';

        const [movieBanners, tvBanners] = await Promise.all([
          fetchBannerImages('movie'),
          fetchBannerImages('tv')
        ]);
        const banners = movieBanners.concat(tvBanners);
        shuffleArray(banners);

        banners.forEach(item => {
          const banner = createBanner(item);
          discoveryBox.appendChild(banner);
        });

        autoSlide(discoveryBox);
      } catch (error) {
        console.error('Error populating discovery box:', error);
      }
    }

    function autoSlide() {
      const discoveryBox = document.querySelector('.discover-screen .discovery-box');
      const pauseDuration = 4000;
      const banners = discoveryBox.querySelectorAll('.banner');
      let currentIndex = 0;
      let timeoutId;

      function slide() {
        timeoutId = setTimeout(() => {
          if (currentIndex >= banners.length - 1) {
            currentIndex = 0;
          } else {
            currentIndex++;
          }
          const nextBanner = banners[currentIndex];
          discoveryBox.scrollTo({ left: nextBanner.offsetLeft, behavior: 'smooth' });
          slide();
        }, pauseDuration);
      }

      slide();

      discoveryBox.addEventListener('mouseover', () => {
        clearTimeout(timeoutId);
      });

      discoveryBox.addEventListener('mouseleave', () => {
        slide();
      });
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      fetchAndDisplay('movie', 'latest-movies-container');
      fetchAndDisplay('tv', 'latest-tv-container');
      populateDiscoveryBox();

      const scrollButtons = document.querySelectorAll('.scroll-button');
      scrollButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const containerId = button.id.includes('tv') ? 'latest-tv-container' : 'latest-movies-container';
          const container = document.getElementById(containerId);

          container.scrollBy({
            left: button.id.includes('left') ? -200 : 200,
            behavior: 'smooth',
          });
        });
      });

      const searchInput = document.getElementById('search-input');
      const searchButton = document.querySelector('.search-button');

      searchButton.addEventListener('click', function () {
        const searchInputValue = searchInput.value.trim();
        if (searchInputValue !== '') {
          window.location.href = `search_results.html?q=${encodeURIComponent(searchInputValue)}`;
        }
      });
    });
  </script>
</body>
</html>
